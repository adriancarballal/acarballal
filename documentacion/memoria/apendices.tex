\appendix
\chapter{Patrones de diseño utilizados}

\section{MVC}
Este patrón permite una clara separación entre la vista de una aplicación web y su modelo correspondiente, gracias a un controlador que los mantiene desacoplados en todo momento, de modo que no necesiten conocer la naturaleza el uno del otro.

\begin{itemize}
\item \textbf{Modelo:} Esta es la representación específica de la información con la cual el sistema opera. La lógica de datos asegura la integridad de estos y permite derivar nuevos datos.
\item \textbf{Vista:} Este presenta el modelo en un formato adecuado para interactuar, usualmente la interfaz de usuario.
\item \textbf{Controlador:} Este responde a eventos, usualmente acciones del usuario e invoca cambios en el modelo y probablemente en la vista.
\end{itemize}

\section{Transfer Object} 
Este patrón sirve para agrupar un conjunto de atributos procedentes de uno o varios objetos del dominio y es aplicable en el caso de que necesitemos representar un conjunto de atributos procedentes de uno o varios objetos del dominio.

Cualquier componente que sigue este patrón ofrece getters \footnote{métodos para obtener el valor de un atributo} y/o setters \footnote{métodos que permiten asignar el valor a un atributo} para acceder y/o establecer a los atributos.

\section{Data Access Object}
El principal objetivo de este patrón es desacoplar la lógica de negocio de la lógica de acceso a datos, de manera que se pueda sustituir la fuente de datos fácilmente. De esta manera, usando este patrón podremos seleccionar el tipo de fuente de datos durante la instalación o configuración de una aplicación.

\section{Facade}
El patrón facade (o fachada) sirve para proveer de una interfaz unificada y sencilla que haga de intermediaria entre el cliente y un interfaz o conjunto de interfaces más complejas. Esto basicamente consigue una independencia del código que la usa.

En nuestro sistema, nos permite poder cambiar el código de acceso a datos sin tener que variar por ello la parte de código del modelo que sirve las funcionalidades al controlador.

\section{Business delegate}
El objetivo de este patrón es facilitar a la capa cliente ocultando las tecnologías utilizadas en el modelo. Este patrón es utilizado cuando se quiere proporcionar una capa de acceso al modelo que oculte la tecnología usada en su implementación.
Las ventajas que proporciona el uso de este patrón:
\begin{itemize}
	\item Mellora o mantemento.
	\item Permite separación de roles: creadores da capa cliente e creadores da capa modelo.
	\item Pode proporcionar caché para mellorar a eficiencia.
\end{itemize}

\section{Decorador}
Este patrón permite añadir responsabilidades a un objeto dinámicamente, proporcionando una alternativa flexible a la extensión de una clase, es decir, se sirven de la herencia para extender sus responsabilidades.

Mediante la aplicación de este patrón se consigue:
\begin{itemize}
	\item Añadir responsabilidades a objetos de manera dinámica y transparente.
	\item Para suprimir responsabilidades de los objetos.
	\item Cuando no es práctico el uso de la herencia.
\end{itemize}

\section{Factoria abstracta}
Este patrón utiliza una interfaz para la creación de familias de objetos relacionados sin especificar sus clases concretas, muy utilizado para proporcionar múltiples look-and-feels mediante la definición de un juego de componentes.

La aplicabilidad de este patrón radica en:
\begin{itemize}
	\item Un sistema debe ser independiente de la forma en que sus productos son creados y representados.
	\item Un sistema debe ser configurado con una de muchas familias de productos disponibles.
	\item Una familia de productos son diseñados para su uso conjunto, y se requiere asegurar este uso conjunto
	\item Se desea proporcionar una biblioteca de productos presentando su interfaz, pero no su implementación
\end{itemize}

\section{Singleton}
El patrón singleton (o instancia única) se utiliza cuando es necesario asegurarse de que una clase tiene sólo una instancia y se quiere proporcionar un punto global de acceso a ella.

Este patrón está compuesto por una clase que define como privado su constructor, con el fin de evitar la creación de nuevos objetos, e incluye un atributo de clase privado que se usa para alojar la instancia única y un método que permite el acceso a dicha instancia.

\section{Command}
El patrón Command (Comando) encapsula una petición como un objeto, de modo que permite la parametrización de clientes con diferentes peticiones, crear colas de peticiones y soporte de operaciones cancelables (undo).

La aplicabilidad de este patrón radica en:
\begin{itemize}
	\item Establecer como parámetro de un objeto la acción a realizar.
	\item Especificar, encolar, y ejecutar peticiones en diferentes momentos.
	\item Soporte de Deshacer.
	\item Soporte de Logging
	\item Soporte de Transacciones
\end{itemize}

\section{Chain of Responsability}
El patrón Chain of Responsability (Cadena de responsabilidad) permite la posibilidad de gestionar una petición a más de un objeto mediante el encadenamiento de receptores desacoplando el emisor de la petición de los receptores (receptor implícito). Se establece una cadena de objetos que delegan la petición
hasta que uno se hace cargo.

Veamos su diversas aplicaciones:
\begin{itemize}
	\item Más de un objeto puede manejar una petición, y no se conoce a priori cual de ellos.
	\item No se desea identificar explícitamente el receptor de una petición.
	\item Los objetos que pueden manejar la petición varían dinámicamente.
\end{itemize}

\section{Template}
El patrón Plantilla define el esqueleto de un algoritmo en una operación, pero difiere algunos pasos a las subclases, con el objetivo de implementar un método que difiera en otros métodos abstractos las partes del algoritmo que no se conocen o que son específicas. En otras palabras, es un método que define un algoritmo en base a una serie de operaciones abstractas que son redefinidas por las subclases para obtener un comportamiento concreto.

La aplicabilidad de este patrón es:
\begin{itemize}
	\item Implementar las partes invariables de un algoritmo una única vez y permitir que las subclases definan el comportamiento que cambia.
	\item Factorización de comportamiento común de las subclases en la superclase (evitar replicación de código mediante generalización)
	\item Para controlar la extensiones de las subclases. 
\end{itemize}

\chapter{Manuales}
\section{Manual de instalación}

Mediante este apéndice se explicará las diferentes partes en las que se dividen la instalación del sistema dentro de un servidor, tal y como se encuentra en la actualidad. Todas las pruebas que se han realizado en el capítulo \titleref{pruebas} se han realizado contra dicho servidor cuando se han creido oportunas, como son el caso de la pruebas de integración (ver página \pageref{integracion}) y las pruebas de estrés (ver página \pageref{estres}).

La instalación se centra en la plataforma Windows, tal y como se encuentra configurado en el sistema online, aunque, como ya se especificó, el sistema final es multiplataforma.

\subsection{Base de datos}
Para la instalación de MySql 5.0.45 (podemos encontrarlo en la carpeta \textit{INSTALACIÓN} dentro del CD-ROM no se modificarán las opciones proporcionadas por el instalador por defecto. Una vez finalizada se ejecutará el \textit{MySQL Server Instance Configuration Wizard}, donde tendremos que realizar los siguiente cambios:
\begin{itemize}
	\item Marcar la casilla referente a \textit{Best Support For Multilingualism (UTF-8)}.
	\item Desmarcar la casilla \textit{Install As Windows Service}.
	\item Marcar la casilla \textit{Install Bin Directory In Windows PATH}.
\end{itemize}

Una vez terminada la instalación debemos configurar nuestra propia base de datos siguiendo estos pasos:
\begin{itemize}
	\item 
\begin{itemize}
	\item Iniciamos el servidor de base de datos mediante el comando \textit{mysqld-nt}.
	\item Creamos una base de datos de nombre \textit{elmas} mediante el comando \textit{mysqladmin -u root create elmas}.
	\item Creamos un usuario de nombre \textit{elmas} para acceder de forma local.
	\begin{itemize}
		\item \textit{mysql -u root}
		\item \textit{GRANT ALL PRIVILEGES ON elmas.* to elmas@localhost IDENTIFIED BY 'elmas', elmas@localhost.localdomain IDENTIFIED BY 'elmas';}
	\end{itemize}	
\end{itemize}
	\item Podremos acceder a la base de datos que hemos creado mediante el comando \textit{mysql -u elmas --password=elmas elmas}.
	\item Podremos apagar el servidor de bases de datos con \textit{mysqladmin -u root shutdown}.
\end{itemize}
\subsection{Apache}
Para la configuración del contenedor web mencionado durante todo esta memoria se utilizará Apache 2. Podremos obtener el instalador de este servidor http tanto en la carpeta \textit{INSTALACIÓN} en el CD-ROM proporcionado como en \URL{http://archive.apache.org/dist/httpd/}. El archivo de instalación para la plataforma Windows será \textit{apache\_2.2.4-win32-x86-no\_ssl.msi}.

Una vez que lo hemos instalado siguiendo el instalador tendremos que configurar nuestro contenedor añadiendo el siguiente texto al archivo \textit{httpd.conf} que se encuentra en la carpeta \textit{conf}:

{\tt \scriptsize
\begin{verbatim}
DocumentRoot "C:\elmas_container"

<VirtualHost *:80>
  ServerName elmas.udc.es
  ProxyPass / http://localhost/
  ProxyPassReverse / http://localhost/
</VirtualHost>

listen 8081
<VirtualHost *:8081>
   ServerName elmas.udc.es
</VirtualHost>

<Directory "C:/elmas_container">
    AllowOverride FileInfo AuthCOnfig Limit
    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
    <Limit GET POST OPTIONS PROPFIND>
        Order allow,deny
        Allow from all
    </Limit>
    <LimitExcept GET POST OPTIONS PROPFIND>
        Order deny,allow
        Deny from all
    </LimitExcept>
</Directory>
\end{verbatim}
}

Se deberá comprobar si las siguientes líneas dentro del mismo fichero están descomentadas:
\begin{itemize}
 \item LoadModule proxy\_module modules/mod\_proxy.so
 \item LoadModule proxy\_connect\_module modules/mod\_proxy\_connect.so
 \item LoadModule proxy\_http\_module modules/mod\_proxy\_http.so
 \item LoadModule proxy\_ftp\_module modules/mod\_proxy\_ftp.so
\end{itemize}

\subsection{Apache Tomcat}
Se utiliza Apache Tomcat 6 como servidor web de nuestra aplicación. Se puede instalar descomprimiendo el archivo \textit{apache-tomcat-6.0.10.exe}, el cual se puede obtener tanto de \URL{http://archive.apache.org/dist/tomcat/tomcat-6/v6.0.10/bin/} como de la carpeta \textit{INSTALACIÓN} del CD-ROM o desde. 
\\ \\
Una vez hecho esto, crearemos un usuario con el rol de manager añadiendo al archivo \textit{conf/tomcat-users.xml}:
{\tt \scriptsize
\begin{verbatim}
  <user name="tomcat" password="tomcat" roles="tomcat,manager"/>
\end{verbatim}
}
Se necesita añadir un driver JDBC en la carpeta \textit{lib} para la comunicación con la base de datos, el archivo \textit{mysql-connector-java-5.0.5.jar} en \textit{INSTALACIÓN}.

Se añadirá un DataSource global mediante:

\begin{itemize}
	\item Insertando el siguiente código en el tag \textit{GlobalNamingResources} dentro del fichero \textit{conf/server.xml}:
{\tt \scriptsize
\begin{verbatim}
<Resource name="jdbc/pojo-examples-ds"
	auth="Container"
  type="javax.sql.DataSource"
  driverClassName="com.mysql.jdbc.Driver"
  url="jdbc:mysql://localhost/elmas"
  username="elmas"
  password="elmas"
  maxActive="4"
  maxIdle="2"
  maxWait="10000"
  removeAbandoned="true"
  removeAbandonedTimeout="60"
  logAbandoned="true"
  validationQuery="SELECT COUNT(*) FROM PingTable"/>
\end{verbatim}
}
	\item Añadiendo el siguiente código en el tag \textit{Context} en \textit{conf/context.xml}:
{\tt \scriptsize
\begin{verbatim}
<ResourceLink name="jdbc/pojo-examples-ds" global="jdbc/pojo-examples-ds"
	type="javax.sql.DataSource"/>
\end{verbatim}
}
\end{itemize}

\subsection{Integración entre Apache 2 y Apache Tomcat 6}
Debido a fuerte integración que nos proporcionan Apache 2 y Tomcat 6, se pueden configurar de modo que ocultemos los puertos que se manejan por debajo, de modo que el usuario final no conozca la estructuración de las aplicaciones instaladas. Mediante la instalación de un único plugin se puede conseguir redireccionar la entrada del puerto 80 directamente al puerto por defecto que utiliza Tomcat. Se trata en este caso del módulo \textit{mod\_jk-1.2.27-httpd-2.2.10.so}.
Se especificará con detalle como se instala:
\begin{itemize}
	\item Obtendremos el módulo, el cual se puede obtener en \URL{http://archive.apache.org/dist/} \URL{tomcat/tomcat-connectors/jk/binaries/win32/jk-1.2.27/} o en el CD-ROM. Lo renombraremos a \textit{mod\_jk.so} y lo copiaremos en la carpeta \textit{modules} de Apache 2.
	\item Crearemos un fichero de nombre \textit{workers.properties} en la carpeta conf de Tomcat 6 con el siguiente contenido:
	{\tt \scriptsize
\begin{verbatim}
# Define 1 real worker using ajp13
worker.list=ajp13
# Set properties for worker1 (ajp13)
worker.worker1.type=ajp13
worker.worker1.host=localhost
worker.worker1.port=8009
\end{verbatim}
}
	\item Añadimos la siguientes líneas en el fichero de configuración de Apache 2 (\textit{conf/httpd.conf}).
	{\tt \scriptsize
\begin{verbatim}
LoadModule jk_module modules/mod_jk.so
Include "C:/Archivos de programa/Apache Software Foundation/Tomcat 6.0/conf/auto/mod_jk.conf"
\end{verbatim}
}
	\item Dentro del fichero de configuración de Tomcat 6 se realizarán los siguientes cambios:
		\begin{itemize}
			\item Dentro del tag \textit{Server} añadiremos:
{\tt \scriptsize
\begin{verbatim}
<Listener className = "org.apache.jk.config.ApacheConfig" 
    workersConfig="conf/workers.properties" 
    mod_Jk="C:/Archivos de Programa/Apache Software Foundation/
        Apache Group/Apache2/modules/mod_jk.so" 
    jkLog="logs/mod_jk.log" jkDebug="info" noRoot="false"/>
\end{verbatim}
}
			\item Dentro del tag \textit{Engine} añadiremos:
{\tt \scriptsize
\begin{verbatim}
<Listener className = "org.apache.jk.config.ApacheConfig" 
    workersConfig="conf/workers.properties" 
    mod_Jk="C:/Archivos de Programa/Apache Software Foundation/
        Apache Group/Apache2/modules/mod_jk.so" 
    jkLog="logs/mod_jk.log" jkDebug="info" noRoot="false"/>
\end{verbatim}
}

		\end{itemize}
\end{itemize}
\subsection{FFMpeg}
Para la compresión de los videos se utiliza un programa en segundo plano, en concreto FFMpeg, el cual lo podemos encontrar en el CD-ROM. En nuestro caso, ya se proporcionan todos los codecs, tanto de audio como de video, para todos los formatos disponibles hasta la fecha. Para su instalación en el servidor sólo tendremos que copiar la carpeta \textit{FFMpeg} del directorio \textit{INSTALACIÓN} donde deseemos.

\subsection{Configuración}
Sólo resta añadir la aplicación al servidor moviendo el archivo \textit{elmas.war} localizado en la carpeta de instalación del CD-ROM en la carpeta \textit{webapp} del servidor Tomcat.
Se deben configurar una serie de variables dentro del servidor web, tal y como se indica en el apartado \titleref{config} en la página \pageref{config}. Para ello se modificará el archivo web.xml una vez que el archivo \textit{elmas.war} se deploye. En el caso de la instalación inicial del sistema se tendrá que modificar las siguientes variables:
\begin{itemize}
	\item \textit{unavailable/snapshot}, que debe de corresponderse con la imagen por defecto si ésta no se puede obtener del video añadido.
	\item \textit{temporal/directory}, que especifica la carpeta temporal donde se realizarán las codificaciones de los videos.
	\item \textit{ffmpeg/application/path}, ruta a la aplicación de compresión.
	\item \textit{container/directory}, especifica la carpeta donde se desean guardar los videos originales y las compresiones de los mismos.
	\item \textit{container/url}, determina la url pública al contenedor multimedia.
	\item \textit{max/parallels/processes}, donde se elegirá el número máximo de compresiones paralelas que podrá realizar el sistema.
\end{itemize}

En la configuración final del sistema dichas variables adoptan los siguientes valores:
{\tt \scriptsize
\begin{verbatim}
<env-entry>
	<env-entry-name>unavailable/snapshot</env-entry-name>
	<env-entry-value>C:\elmas_container\unavailable.jpg</env-entry-value>
	<env-entry-type>java.lang.String</env-entry-type>
</env-entry>
   
<env-entry>
	<env-entry-name>temporal/directory</env-entry-name>
	<env-entry-value>C:\\elmas_temporal\\</env-entry-value>
	<env-entry-type>java.lang.String</env-entry-type>
</env-entry>
    
<env-entry>
	<env-entry-name>ffmpeg/application/path</env-entry-name>
	<env-entry-value>C:\\ffmpeg\\ffmpeg.exe</env-entry-value>
	<env-entry-type>java.lang.String</env-entry-type>
</env-entry>

<env-entry>
	<env-entry-name>portal/url</env-entry-name>
	<env-entry-value>http://elmas.udc.es:8081/</env-entry-value>
	<env-entry-type>java.lang.String</env-entry-type>
</env-entry>
    
<env-entry>
	<env-entry-name>container/directory</env-entry-name>
	<env-entry-value>C:\\elmas_container</env-entry-value>
	<env-entry-type>java.lang.String</env-entry-type>
</env-entry>
     
<env-entry>
	<env-entry-name>container/url</env-entry-name>
	<env-entry-value>http://elmas.udc.es:8081/</env-entry-value>
	<env-entry-type>java.lang.String</env-entry-type>
</env-entry>  
\end{verbatim}
}


\section{Manual de modificación de interfaces}
Una de las grandes ventajas que presenta Tapestry 5 radica en la posibilidad de realizar diseño de la interfaz sin necesidad de tener conocimiento de como se implementa un markup. Esto permite que un diseñador gráfico con conocimientos de html puro sea capaz de realizar cambios a su gusto. En este apéndice se mostrará la forma de realizar estos cambios de manera sencilla, de modo que sirva a modo de manual para su modificación.
Antes de nada, cabe destacar que la modificaciones que se pueden realizar sobre la vista se pueden realizar de dos forma específicas:
\begin{itemize}
	\item Modificando el CSS asociado a las diferentes páginas, pero que obliga a que la estructura de la vista no sea modificable.
	\item Modificando las plantillas o tml asociados a cada página dentro de la implementación, lo cuál si permite modificar la estructura de la vista.
\end{itemize}
Como el primer punto no supone ningun problema, ya que sólo se necesita modificar el fichero css determinado, no vamos a centra en como se puede modificar un tml.

\begin{figure}[htp]
\centering
\includegraphics*[width=15cm]{imagenes/votetml.png}
\caption{Ejemplo página tml}
\label{tml}
\end{figure}

En esta figura se muestran tres tipos de código representados en colores diferentes:
\begin{itemize}
	\item En negro se recoge el código html puro.
	\item En rojo se distingue el código perteneciente a componentes embebidos.
	\item En azul están los mensajes internacionalizados y los objetos inyectados dentro de la página.
\end{itemize}

Dentro de nuestro ejemplo podemos distinguir:
\begin{itemize}
	\item \textbf{Declaración de un espacio de nombres}
	{\tt \scriptsize
\begin{verbatim}
<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:t="http://tapestry.apache.org/schema/tapestry_5_0_0.xsd">
\end{verbatim}
}
	\begin{itemize}
		\item Cualquier elemento o atributo que tenga prefijo t pertenece al
espacio de nombres de Tapestry
		\item En el markup generado, no se incluye la importacion del
espacio de nombres de Tapestry
	\end{itemize}
	\item \textbf{Componentes}
	
	Es posible incluir componentes dentro de una plantilla utilizando el elemento correspondiente (dentro del espacio de nombres de Tapestry).
{\tt \scriptsize
\begin{verbatim}
<t:if t:test="userSessionExists">
</t:if>
\end{verbatim}
}
	\item \textbf{Mensajes internacionalizados}
{\tt \scriptsize
\begin{verbatim}
<spam class="favourite" title="${message:markAsFavourite}" />
\end{verbatim}
}

	\textit{Message}: indica que valor es la clave de un mensaje del catálogo de mensajes. Dicho catálogo forma parte del soporte de internacionalizacion que proporciona Tapestry:
\begin{itemize}
	\item Permiten que los textos fijos de las plantillas, en lugar de escribirlos directamente en ellas, se escriban
en un fichero de mensajes
	\item Ficheros .properties
	\item Existe un catalogo de mensajes general para toda la aplicacion
	\item Es posible definir un fichero de mensajes específicos para una página
\end{itemize}
	\item \textbf{Objetos inyectados o propiedades}
	
	En el caso de acceso a propiedades es posible:	
\begin{itemize}
	\item Referirse a subpropiedades
	\item Invocar a un metodo del objeto que no sea un getter (utilizando parentesis a continuacion del
nombre del metodo)
\end{itemize}
\end{itemize}

Gracias a todo esto que se acaba de explicar, un diseñador podría modificar la estructura y la apariencia de la vista teniendo en cuenta que partes del código deben permanecer inalteradas y cuales son modificables, en este caso, el html puro dentro del \textit{tml}.
\chapter{Contenido del CD-ROM}
Se adjunta junto con la memoria de este proyecto un CD-ROM con todo el material necesario para poner en funcionamiento el sistema que se ha abordado a lo largo de esta memoria. Dicho CD-ROM sigue la siguiente estructura:
\begin{itemize}
	\item FFMepg$\backslash$
	
	Contiene los archivos del programa de compresión homónimo.
	\item SRC$\backslash$
	
	Contiene el código fuente de la aplicación.
	\item INSTALACIÓN$\backslash$
	
	Contiene los archivos y programas necesarios para instalar la aplicación en un servidor http.
	\begin{itemize}
		\item mysql-essential-5.0.45-win32.msi
		\item apache\_2.2.11-win32-x86-openssl-0.98i.msi
		\item apache-tomcat-6.0.14.tar.gz
		\item mysql-connector-java-5.0.5.jar
		\item MySqlCreateTables.sql
		\item elmas.war
	\end{itemize}
	\item DOCUMENTACIÓN$\backslash$
	
	Contiene la memoria del proyecto en formato pdf.
	\item SCREENCAST$\backslash$
	
	Contiene dos videos de presentación de ambos portales, tanto el web como el optimizado para dispositivos móviles.
	\begin{itemize}
		\item web\_screencast.flv
		\item mobile\_screencast.flv
	\end{itemize}
\end{itemize}
